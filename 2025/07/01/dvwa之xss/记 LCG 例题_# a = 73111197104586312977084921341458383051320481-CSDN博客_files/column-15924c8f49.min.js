$(function(){var e=window.location.href;if(e.indexOf("category_")>-1){var o=function(){var e=setInterval(function(){if(document.getElementById("csdn-toolbar")){clearInterval(e),l=document.getElementById("csdn-toolbar").offsetHeight;var o=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop;o-r>0&&o<n-a&&a>0?t.css({position:"fixed","z-index":"999",left:c+"px",top:l,width:s}):t.css({position:"unset","z-index":"10",left:"0px",top:"0",width:s})}},100)},t=$("#column .column_info_box"),n=$("#column .column_article_list").height(),a=$("#column .column_article_list li").length?$("#column .column_article_list li").height():0,i=document.getElementsByTagName("main")[0],c=i.offsetLeft,s=i.offsetWidth,r=document.getElementsByTagName("header")[0].offsetHeight,l=0;o(),$(window).scroll(function(){o()}),$(window).resize(function(){c=i.offsetLeft,s=i.offsetWidth,o()})}}),$(function(){function e(){j="https://csdnimg.cn/release/download/images/pay_error.png",D="已扫码<br>请在手机端操作",$("#payCode").html('<div class="renovate"><img src="'+j+'"><span>'+D+"</span></div>"),$("#payCodeImg").html('<img class="repeat-again" src="'+j+'"><span class="text">'+D+"</span>")}function o(o){var a={goods_id:o,product_id:o,flag:17,request_type:4,is_use_balance:I,coupon_key:N,sale_source:U,success_function:t,error_function:i,timeout_function:c,get_pay_success_callback:n,payment_function:e,report_ext:{spm:"1001.2101.3001.10043"},spm:"1001.2101.3001.10043"};$("#payCode").html(R),$("#payCodeImg").html(F),cart.qrPay(a)}function t(e,o){z?d("payCode",o.pay_url):d("payCodeImg",o.pay_url),B=o.pay_url}function n(){a()}function a(){var e=null,o=1e4;e&&clearTimeout(e),S.boxshadow.fadeOut(function(){showToast({html:'<img src="'+blogStaticHost+'dist/pc/img/column_subscribe.png" style="width: 472px; height: auto;position: relative;"><div id="column_subscribe_close" style="width: 34px;height: 34px;position: absolute;left: 50%;transform: translateX(-60%);bottom: 15px;cursor: pointer;"></div>',bottom:"10%",zindex:9e3,speed:500,time:o,subscribe:!0,close:function(){window.csdn.report&&"function"==typeof window.csdn.report.reportClick&&window.csdn.report.reportClick({spm:"3001.10834"}),$("#st_toastBox").fadeOut(function(){$("#st_mask").fadeOut(function(){window.location.reload()})})}})}),window.csdn.report&&"function"==typeof window.csdn.report.reportView&&window.csdn.report.reportView({spm:"3001.10834"}),e=setTimeout(function(){window.location.reload()},o)}function i(e){showToast({text:e.errorMessage,bottom:"10%",zindex:9e3,speed:500,time:1500})}function c(){z?S.payCode.find("#payCode").html(V):S.getPay.find("#payCodeImg").html(H)}function s(e,o){var t=Number(e)-Number(o);return t>0?t.toFixed(2):t<0?t.toFixed(2):t}function r(e){$.ajax({type:"GET",url:"https://mall.csdn.net/mp/mallorder/api/internal/goods/getGoodsInfo?goods_id="+e+"&product_id="+e+"&flag=17",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(t){T=t.data.available_amount,t.data.coupon_discount&&t.data.coupon_key&&(O=1*t.data.coupon_discount,N=t.data.coupon_key),G++,G<=1&&(0==T?(I=0,$(".pay-code-radio").prop("disabled",!0)):s(L,O)>0?(I=1,$(".pay-code-radio").attr("data-flag","true"),$(".pay-code-radio").prop("checked",!0)):(I=0,$(".pay-code-radio").prop("disabled",!0))),$(".pay-balance .balance").text(T),$(".pay-code-balance .balance").text(T),l(),o(e)}})}function l(){$(".subscribe-available-balance .subscribe-available-balance-t").css({display:"block"}),O?(s(L,O)>0?I?(s(s(L,O),T)>0?($(".available-balance-0").text("¥"+T),$(".available-balance-1").text("¥"+s(s(L,O),T))):($(".available-balance-0").text("¥"+s(L,O)),$(".available-balance-1").text("¥0")),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})):($(".available-balance-1").text("¥"+s(L,O)),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance .subscribe-available-balance-t").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})):($(".available-balance-1").text("¥0"),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance .subscribe-available-balance-t").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})),$(".coupons-box .coupons-money").html("¥"+O),$(".coupons-box").fadeIn()):I?(s(L,T)>0?($(".available-balance-0").text("¥"+T),$(".available-balance-1").text("¥"+s(L,T))):($(".available-balance-0").text("¥"+L),$(".available-balance-1").text("¥0")),$(".subscribe-price-box").css({display:"none"}),$(".subscribe-available-balance").css({display:"block"})):($(".now-price").text("¥"+L),$(".subscribe-available-balance").css({display:"none"}),$(".subscribe-price-box").css({display:"block"}))}function d(e,o){var t=qrcode(6,"M");t.addData(o),t.make(),$("#"+e).html(t.createImgTag(3,3)),$("#"+e).html($("#"+e).html()),z&&S.boxshadow.fadeIn(function(){S.payCode.fadeIn()})}function u(e){+new Date,+new Date(e);P-=1;var o=parseInt(P/60/60%24);o=o<10?"0"+o:o;var t=parseInt(P/60%60);t=t<10?"0"+t:t;var n=parseInt(P%60);n=n<10?"0"+n:n,$(".time-hour").text(o),$(".time-minite").text(t),$(".time-second").text(n)}function p(){$(".directory-boxshadow-dialog").hide(),setCookieBaseHour("vip_limited_time_num",(new Date).getTime(),24)}function m(e,o){if("popup"==e)window.csdn&&window.csdn.userOrderTip&&window.csdn.userOrderTip.show({tabs:["superVipForPopup"]});else{var t=document.createElement("a");t.style.display="none";var n=vipUrlV;o&&n.indexOf("spm")===-1&&(n+=n.indexOf("?")===-1?"?spm="+o:"&spm="+o),t.href=n,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}function b(){var e=$(this),o=e.data("id");if(e.data("type"))var t=blogUrl+"phoenix/web/v1/subscribe/un-subscribe-study?columnId="+o;else var t=blogUrl+"phoenix/web/v1/subscribe/subscribe-study?columnId="+o;getCookie("UserName")?$.ajax({url:t,type:"post",dataType:"json",xhrFields:{withCredentials:!0},success:function(o){200==o.code&&o.data.status?e.data("type")?q.indexOf("/article/details/")>-1?window.location.reload():($(".studyvip-unsubscribe").css("display","inline-block"),$(".studyvip-subscribe").css("display","none")):q.indexOf("/article/details/")>-1?a():($(".studyvip-subscribe").css("display","inline-block"),$(".studyvip-unsubscribe").css("display","none"),a()):showToast({text:o.data.msg||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})},error:function(e){showToast({text:e.data.msg||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})}}):window.csdn.loginBox.show()}function f(e){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(o);return null!=t?unescape(t[2]):""}function w(e,o,t,n,i){if(window.csdn&&window.csdn.userOrderPayment){var c={params:[{flag:17,goodsId:e,productId:e}],goodsExtraInfo:{columnArticlesNum:o||0,columnSubscribeNum:t||0,hotSellingRank:n||0,viewCount:0,level:0,nickName:nickName},get_pay_success_callback:a};i&&i.spm&&(c.report_ext={spm:i.spm},c.spm=i.spm),$.ajax({type:"GET",url:blogUrl+"phoenix/web/v1/column/purchase-info",dataType:"json",xhrFields:{withCredentials:!0},data:{columnId:e},success:function(e){200==e.code&&e.data&&(c.goodsExtraInfo.level=e.data.level,c.goodsExtraInfo.viewCount=e.data.viewCount)},complete:function(){window.csdn.userOrderPayment.show(c)}})}}function h(e,o){if(e.show){var t='<div class="column_coupon_main '+(e.receive?"active":"")+'">                <img class="column_coupon_icon" src="'+e.activityIcon+'" alt="">                <div class="column_coupon_text">                <span class="column_coupon_l">'+e.couponDesc+'</span>                <span class="column_coupon_m"></span>                <span class="column_coupon_r" data-couponId="'+e.groupNumber+'" data-columnId="'+o+'">'+(e.receive?"已领取":"立即领取")+"</span>                </div>            </div>";S.columnCouponBox.html(t),S.columnCouponBox.css({display:"flex"})}}function g(e,o,t){$.ajax({type:"GET",url:blogUrl+e,dataType:"json",xhrFields:{withCredentials:!0},data:{columnId:t},success:function(e){200==e.code?h(e.data,t):o.remove()},error:function(e){o.remove()}})}function x(e,o,t,n,a,i){$.ajax({type:"GET",url:blogUrl+e,dataType:"json",xhrFields:{withCredentials:!0},data:{columnId:t},success:function(c){200==c.code?c.data?(o.find(".column_coupon_main").addClass("active"),o.find(".column_coupon_r").html("已领取"),z?w(t,n,a,i):r(t)):setTimeout(function(){x(e,o,t)},500):showToast({text:c.message||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})},error:function(e){showToast({text:e.message||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})}})}function y(e,o,t,n,a,i){$.ajax({url:blogUrl+e,type:"post",dataType:"json",data:{columnId:t,groupNumber:o},xhrFields:{withCredentials:!0},success:function(e){200==e.code&&e.data?x(S.columnCouponStatus,S.columnCouponBox,t,n,a,i):showToast({text:e.message||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})},error:function(e){showToast({text:e.message||"操作失败，请重试！",bottom:"10%",zindex:9e3,speed:500,time:1500})}})}function v(){var e=$(".sort-dropdown"),o=e.find(".selected-text"),t=e.find(".dropdown-item"),n={0:"默认排序",1:"最新发布",2:"最早发布",3:"最多阅读",4:"最少阅读"},a=n[currentOrder]||"默认排序";o.text(a),t.each(function(){$(this).data("order")==currentOrder&&$(this).addClass("active")}),e.on("click",function(o){o.stopPropagation(),e.toggleClass("active")}),t.on("click",function(){var e=$(this).data("order");urlParams.set("orderBy",e);var o=baseUrl+".html?"+urlParams.toString();window.location.replace(o||window.location.href)}),$(document).on("click",function(o){!e.is(o.target)&&0===e.has(o.target).length&&e.hasClass("active")&&e.removeClass("active")})}function C(e){J.clear(),J.makeCode(e)}function _(e,o){var t={fromshare:"column"==W?"blogcolumn":"blogdetail"};e&&o&&(t={fromshare:"column"==W?"blogcolumn":"blogdetail",sharetype:e,shareId:o}),Q="column"==W?currentUrl:articleDetailUrl,Q+="?fromshare="+t.fromshare+"&sharetype="+("column"==W?"blogcolumn":"blogdetail")+"&sharerId="+("column"==W?SharecolumnId:articleId)+"&sharerefer=PC&sharesource="+currentUserName,C(Q+"&sharefrom=qr"),M=!0,setTimeout(function(){window.csdn.report&&"function"==typeof window.csdn.report.reportView&&window.csdn.report.reportView({spm:"3001.7493",extra:{type:"column"==W?"blogcolumn":"blogdetail"}}),$("#tool-QRcode").show()},100)}function k(e){var o=document.createElement("input");o.value=e,document.body.appendChild(o),o.select(),document.execCommand("Copy"),o.remove()}var I=0,T=0,B="",N="",O=0,U="",P=300,q=window.location.href;q.indexOf("category_")>-1&&v(),$(document).on("click",".tip-subscribe-column>span",function(){$(this).parent().find(".tip").fadeIn()}),$(document).on("click",".tip-subscribe-column .bt-close",function(){$(".tip-subscribe-column").find(".tip").fadeOut()});var E="",S={boxshadow:$(".skin-boxshadow"),btClose:$(".bt-close"),payCode:$(".pay-code"),btSubscribe:$(".bt-subscribe-article"),btSubscribeColumn:$(".bt-subscribe-text"),getPay:$(".get-pay"),columnCouponBox:$("#columnCouponBox"),columnCouponCheck:"phoenix/web/v1/coupon/check-column-coupon",columnCouponStatus:"phoenix/web/v1/coupon/get-column-coupon-status",columnCouponLook:"phoenix/web/v1/coupon/get-column-coupon"},z=!1;q.indexOf("category_")>-1&&(S.columnCouponBox.length&&(E=S.columnCouponBox.data("id"),g(S.columnCouponCheck,S.columnCouponBox,E)),S.getPay.length&&(z=!1,E=S.getPay.data("id"),getCookie("UserName")&&(U=f("sale_source"),r(E)))),q.indexOf("/article/details/")>-1&&S.columnCouponBox.length&&(z=!0,E=S.columnCouponBox.data("id"),g(S.columnCouponCheck,S.columnCouponBox,E)),$(document).on("click",".bt-subscribe",function(){getCookie("UserName")||window.csdn.loginBox.show()}),S.getPay.on("click",function(){z=!1,E=$(this).data("id"),o(E)}),S.payCode.on("click",".renovate",function(){o(E||$(this).parent().data("id"))}),S.btClose.on("click",function(){S.payCode.fadeOut(function(){S.boxshadow.fadeOut()})});var j=blogStaticHost+"dist/pc/img/pay-time-out.png",D="获取中",F='<img class="repeat-again" src="'+j+'"><span class="text">'+D+"</span>",R='<div class="renov-men"><img src="'+j+'"><span>'+D+"</span></div>",V='<div class="renovate">    <img src="'+blogStaticHost+'dist/pc/img/pay-time-out.png">    <span>点击重新获取</span></div>',H='<img class="repeat-again" src="'+blogStaticHost+'dist/pc/img/pay-time-out.png"><span class="text">点击重新获取</span>';$(".now-price").text();$(".pay-code-radio").click(function(){var e=$(this).attr("data-flag");"true"==e?(I=0,$(this).attr("data-flag","false"),$(this).prop("checked",!1)):(I=1,$(this).attr("data-flag","true"),$(this).prop("checked",!0)),r(E)});var L=$(".subscribe-price .now-price").text().slice(1),G=0;S.payCode.on("click",".blance-bt",function(){window.open(B)}),$(document).on("click",".articleColumnBt",function(){if(getCookie("UserName")){var e=$(this).data("id"),o=$(this).data("report-click"),t=$(this).data("sum")||0,n=$(this).data("people")||0,a=$(this).data("hotrank")||0;w(e,t,n,a,o)}else window.csdn.loginBox.show({spm:"1001.2101.3001.8610"})}),$(document).on("click",".ordertip_header_btn",function(){getCookie("vip_limited_time_num")||$.ajax({type:"GET",url:blogUrl+"phoenix/web/v1/coupon/get-vip-coupon-info",dataType:"json",xhrFields:{withCredentials:!0},success:function(e){if(200==e.code&&e.data&&e.data.canShow){$(".directory-boxshadow-dialog").show(),setCookieBaseHour("vip_limited_time_num",(new Date).getTime(),24),window.csdn.report&&"function"==typeof window.csdn.report.reportView&&window.csdn.report.reportView({spm:"3001.9621"}),$(".limited-num").text(parseInt(e.data.price/100)),e.data.title&&$(".vip-limited-time-top").text(e.data.title),u(e.data.expireDate);var o=setInterval(function(){P<=0?clearInterval(o):u(e.data.expireDate)},1e3)}},error:function(e){}})}),$(document).on("click",".limited-img",function(){p()}),$(document).on("click",".directory-boxshadow-dialog-box",function(){p()}),$(document).on("click",".column-studyvip-pass",function(){if(getCookie("UserName")){var e="",o=JSON.parse($(this).attr("data-report-click"));o&&o.spm&&(e=o.spm),m("control",e)}else window.csdn.loginBox.show()}),$(document).on("click",".column-studyvip-ajax",b),$(document).on("click","#columnCouponBox",function(e){if(getCookie("UserName")){if("column_coupon_r"==e.target.className&&!$(this).find(".column_coupon_main").hasClass("active")){var o=e.target.dataset.couponid,t=e.target.dataset.columnid,n=e.target.dataset.sum||0,a=e.target.dataset.people||0,i=e.target.dataset.hotrank||0;y(S.columnCouponLook,o,t,n,a,i)}}else window.csdn.loginBox.show()});var Q="",A=!0,M=!1,W=$("#tool-share").data("type"),J=new QRCode(document.getElementById("shareCode"),{width:120,height:120,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.L});$("#tool-share").on({mouseenter:function(){setTimeout(function(){window.csdn.report&&"function"==typeof window.csdn.report.reportView&&window.csdn.report.reportView({spm:"3001.7493",extra:{type:"column"==W?"blogcolumn":"blogdetail"}})},50)},mouseover:function(){A?(_(),A=!1):M&&$("#tool-QRcode").show()},mouseout:function(){$("#tool-QRcode").hide()}}),$("#copyPosterUrl").on("click",function(){Q&&(window.csdn.report&&"function"==typeof window.csdn.report.reportClick&&window.csdn.report.reportClick({spm:"3001.7493",extra:{type:"column"==W?"blogcolumn":"blogdetail",from:"from_link"}}),k(Q+"&sharefrom=from_link"),showToast({text:"文章链接已复制",bottom:"10%",zindex:9002,speed:500,time:1500}))}),$("#tool-QRcode").on("click",".btn-share",function(){console.log($(this).data("type"));var e=$(this).data("type"),o="",t="";switch("column"===W?(o=$(".column_title").text(),t=$(".column_text_desc").text()):(o=articleTitle,t=articleDesc),e){case"qq":window.csdn.report&&"function"==typeof window.csdn.report.reportClick&&window.csdn.report.reportClick({spm:"3001.7493",extra:{type:"column"==W?"blogcolumn":"blogdetail",from:"qq"}});var n=o+"-"+nickName+" "+Q+"&sharefrom=qq（想看更多？下载CSDN APP：https://www.csdn.net/apps/download/）";window.open("https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+(Q+"&sharefrom=qq")+"&title="+o+"&desc="+encodeURIComponent(n)+"&summary="+t,"_blank","width=615,height=600");break;case"weibo":window.csdn.report&&"function"==typeof window.csdn.report.reportClick&&window.csdn.report.reportClick({spm:"3001.7493",extra:{type:"column"==W?"blogcolumn":"blogdetail",from:"weibo"}});var a=o+"-"+nickName+" "+Q+"&sharefrom=weibo（想看更多？下载@CSDN APP：https://www.csdn.net/apps/download/）";window.open("https://service.weibo.com/share/share.php?title="+encodeURIComponent(a),"_blank","width=615,height=600")}})});